# ML-Ops-1-Docker

Сервис подготовлен в рамках домашнего задания по курсу MLOps. Использует предобученную LightGBM модель из соревнования https://www.kaggle.com/competitions/teta-ml-1-2025 

## Архитектура решения
```
├── .gitignore
├── Dockerfile
├── README.md
├── requirements.txt
├── app/
│ └── app.py # Ядро сервиса 
├── models/
│ └── model.txt # Сериализованная LightGBM модель
├── src/
│ ├── preprocessing.py # Пайплайн обработки данных
│ └── scorer.py # Модуль прогнозирования
└── train_data/
│ └── train.csv # Данные для обучения (reference), необходимо скачать из соревнования
└── input/ # Директория для загрузки файлов на скоринг
│ └── test.csv
└── output/ # Директория с результатами скоринга
```

## Ключевые особенности

### Многоуровневое логирование
- Регистрация всех событий в файл `/app/logs/service.log`
- Консольный вывод для мониторинга в реальном времени
- 3 уровня детализации:
  - `INFO`: Основные этапы обработки
  - `DEBUG`: Детали преобразования данных
  - `ERROR`: Критические сбои с трейсбэками

### Пайплайн обработки данных (`preprocessing.py`)
1. **Фичи из соревнования**:
   - Логарифмирование сумм транзакций (`log_amount`)
   - Флаг аномальных сумм (`high_amount`)
   - Категории риска для `cat_id` (3 уровня)
   - Частотное кодирование категориальных признаков

2. **Оптимизации**:
   - Удаление избыточных признаков (`merchant_lat`, `merchant_lon`, `post_code`)
   - Импутация средними значениями
   - Автоматическая обработка пропусков

### Модельный слой (`scorer.py`)
- LightGBM с порогом: 0.97781
- Поддержка batch-обработки
- Дополнительные выходы:
  - Топ-5 важных фичей (JSON)
  - График распределения скоров (PNG)

## Быстрый старт

### Требования
- Docker 20.10+
- 1 ГБ свободного места
- Для Windows: WSL2 в Docker Desktop

### Запуск сервиса

1. Скачайте файл `train.csv` из соревнования https://www.kaggle.com/competitions/teta-ml-1-2025 и разместите в директории `./train_data`
2. Скачайте файл `test.csv` из соревнования https://www.kaggle.com/competitions/teta-ml-1-2025 и разместите в директории `./input`
3. Соберите образ
```bash
docker build -t ml-ops-docker .
```
4. Запустите контейнер с монтированием томов (Windows PowerShell):
```bash
docker run -it --rm -v "C:\путь\к\проекту\input:/app/input" `  -v "C:\путь\к\проекту\output:/app/output" `  ml-ops-docker
```
5. После обработки в логах появится сообщение: `__main__ - INFO - All results saved to /app/output`
6. Полученные файлы будут доступны в папке `./output`:
  - sample_submission.csv - предсказания
  - feature_importances.json - важность признаков
  - scores_distribution.png - график распределения

  ## Особенности работы на Windows

При тестировании на Windows 10 возникла проблема, при которой **Watchdog не отслеживал** изменения в маунтированных директориях.

**Принятые решения**:
- Отказ от мониторинга папки в реальном времени
- Упрощение логики до однократной обработки при запуске

Такое решение сохраняет все требования задания, адаптируя их под Windows-окружение.