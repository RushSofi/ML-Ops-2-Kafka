# ML-Ops-2-Kafka

**DISCLAIMER**: –°–µ—Ä–≤–∏—Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø–æ –∫—É—Ä—Å—É MLOps. –î–∞—Ç–∞—Å–µ—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è [TETA-ML-1-2025](https://www.kaggle.com/competitions/teta-ml-1-2025).

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ML-–º–æ–¥–µ–ª–∏, Kafka –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:
1. **interface (Streamlit UI)**:
    - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ CSV
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö transaction_id
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Kafka —Ç–æ–ø–∏–∫ `transactions`
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ PostgreSQL –≤–∏—Ç—Ä–∏–Ω—É:
     - –¢–æ–ø-10 —Ñ—Ä–æ–¥–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
     - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∫–æ—Ä–æ–≤

2. **fraud_detector (ML Service)**:
   - LightGBM –º–æ–¥–µ–ª—å (`model.txt`) —Å –ø–æ—Ä–æ–≥–æ–º 0.95
   - –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥:
     - –õ–æ–≥–∞—Ä–∏—Ñ–º–∏—Ä–æ–≤–∞–Ω–∏–µ amount/population
     - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—á–∞—Å, –Ω–æ—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
     - –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏
     - –ß–∞—Å—Ç–æ—Ç–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ç–æ–ø–∏–∫ `scoring`

3. **db_writer (PostgreSQL Service)**:
   - –ß—Ç–µ–Ω–∏–µ –∏–∑ —Ç–æ–ø–∏–∫–∞ `scoring`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å –ø–æ–ª—è–º–∏:
     - transaction_id
     - score
     - fraud_flag
     - timestamp
   - –°–æ–∑–¥–∞–µ—Ç –≤–∏—Ç—Ä–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

4. **Kafka Infrastructure**:
   - Zookeeper + Kafka –±—Ä–æ–∫–µ—Ä
   - kafka-setup: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ø–∏–∫–∏
   - Kafka UI: –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - PostgreSQL 13 (–≤–∏—Ç—Ä–∏–Ω–∞ fraud_db)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Docker 20.10+
- Docker Compose 2.0+
- 4+ GB —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:
```bash
git clone https://github.com/RushSofi/ML-Ops-2-Kafka.git
cd ML-Ops-2-Kafka 
```
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
```bash
docker-compose up --build
```

# –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º:

* Streamlit UI: http://localhost:8501

* Kafka UI: http://localhost:8080

* –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
docker-compose logs <service_name>  # –ù–∞–ø—Ä–∏–º–µ—Ä: fraud_detector, kafka, interface
```

# –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ test.csv –∏–∑ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è. –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```bash
transaction_time,amount,cat_id,population_city,...
2023-01-01 12:30:00,150.50,shopping_net,500000,...
```
* –î–ª—è –ø–µ—Ä–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π —Å–µ–º–ø–ª –¥–∞–Ω–Ω—ã—Ö (–¥–æ 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π) –∑–∞ —Ä–∞–∑, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–µ –∑–∞–Ω—è–ª–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

# üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

  - –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

  - –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

  - –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ Kafka UI

2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

  - –í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"

  - –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç:

        10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ñ—Ä–æ–¥–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

        –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Å–∫–æ—Ä–æ–≤ (100 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)

# –§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Ö–æ–¥–Ω—ã–µ (transactions):
```bash
{
  "transaction_id": "uuid",
  "data": {
    "amount": 150.50,
    "cat_id": "shopping_net",
    ...
  }
}
```

–í—ã—Ö–æ–¥–Ω—ã–µ (scoring):
```bash
{
  "transaction_id": "uuid",
  "score": 0.968,
  "fraud_flag": 1
}
```
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
.
‚îú‚îÄ‚îÄ fraud_detector/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preprocessing.py    # –§–∏—á–∏–Ω–∂–µ–Ω–∏—Ä–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scorer.py           # LightGBM –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.py                  # Kafka –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model.txt 
‚îÇ   ‚îú‚îÄ‚îÄ train_data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ train.csv
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ db_writer/                  # –°–µ—Ä–≤–∏—Å –∑–∞–ø–∏—Å–∏ –≤ PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ app.py 
‚îú‚îÄ‚îÄ interface/
‚îÇ   ‚îú‚îÄ‚îÄ .streamlit
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.toml
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ app.py                  # Streamlit UI
‚îú‚îÄ‚îÄ docker-compose.yaml
‚îî‚îÄ‚îÄ README.md
```
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
Kafka:
  –¢–æ–ø–∏–∫–∏:
    - transactions (3 –ø–∞—Ä—Ç–∏—Ü–∏–∏)
    - scoring (3 –ø–∞—Ä—Ç–∏—Ü–∏–∏)
  –†–µ–ø–ª–∏–∫–∞—Ü–∏—è: 1 (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
  –ü–∞—Ä—Ç–∏—Ü–∏–∏: 3

PostgreSQL:
  –ë–î: fraud_db
  –¢–∞–±–ª–∏—Ü–∞: transactions


–ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ —Å—Ç–∞—Ä—Ç—É—é—Ç:

  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã (8501, 8080, 5432)

  - –£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å Docker (–º–∏–Ω–∏–º—É–º 4GB)

–ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL:

  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ db_writer –∫ Kafka

  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–ø–∏–∫ scoring —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞:
```bash
docker-compose down -v
docker-compose up --build
```